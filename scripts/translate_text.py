# coding: latin-1

import sys
d={0xFE:"{END}\n\n",
0xF8:"\n",
0x00:"0",
0x01:"1",
0x02:"2",
0x03:"3",
0x04:"4",
0x05:"5",
0x06:"6",
0x07:"7",
0x08:"8",
0x09:"9",
0x0a:"A",
0x0b:"B",
0x0c:"C",
0x0d:"D",
0x0e:"E",
0x0f:"F",
0x10:"G",
0x11:"H",
0x12:"I",
0x13:"J",
0x14:"K",
0x15:"L",
0x16:"M",
0x17:"N",
0x18:"O",
0x19:"P",
0x1a:"Q",
0x1b:"R",
0x1c:"S",
0x1d:"T",
0x1e:"U",
0x1f:"V",
0x20:"W",
0x21:"X",
0x22:"Y",
0x23:"Z",
0x24:"a",
0x25:"b",
0x26:"c",
0x27:"d",
0x28:"e",
0x29:"f",
0x2a:"g",
0x2b:"h",
0x2c:"i",
0x2d:"j",
0x2e:"k",
0x2f:"l",
0x30:"m",
0x31:"n",
0x32:"o",
0x33:"p",
0x34:"q",
0x35:"r",
0x36:"s",
0x37:"t",
0x38:"u",
0x39:"v",
0x3a:"w",
0x3b:"x",
0x3c:"y",
0x3d:"z",
0x3e:"!",
0x40:"?",
0x42:"+",
0x44:"/",
0x46:":",
0x5f:".",
0x8d:"(",
0x8e:")",
0x91:'"',
0xE308:"[Portrait]",
0xE300:"[Dialog]",
0xE200:"[Delay 00]",
0xE201:"[Delay 01]",
0xE202:"[Delay 02]",
0xE203:"[Delay 03]",
0xE205:"[Delay 05]",
0xE206:"[Delay 06]",
0xE20A:"[Delay 0A]",
0xE20F:"[Delay 0F]",
0xE214:"[Delay 14]",
0xE21E:"[Delay 1E]",
0xE23C:"[Delay 3C]",
0xE250:"[Delay 50]",
0xE25A:"[Delay 5A]",
0xE278:"[Delay 78]",
0xe0:"<Ramza>",
0xfa:"[spazio]",
0xfb:"[lista]",
0xfc:"[finelista]",
0xff:"[chiudi]",
0x93:"'",
0x95:" ",
0xD11D:"-",
0xD11F:"[Croce]",
0xD129:"*",
0xDA03:"[Simbolo 03]",
0xDA0A:"[Simbolo 0A]",
0xD9B9:"[Simbolo B9]",
0xDA62:"é",
0xDA63:"è",
0xDA61:"à",
0xDA65:"ú",
0xDA66:"ù",
0xDA68:"-",
0xDA71:"§",
0xDA72:"=",
0xDA74:",",
0xDA75:";",
0xD9C5:"~",
0xD9C7:"[Triangolo]",
0xD9C8:"[Quadrato]",
0xD9CA:"[Cuore]"}


if len(sys.argv) == 0:
  sys.exit(0)
  
filename = sys.argv[1]

num = filename.split(".")[-1]
if (num == "dummy"):
  sys.exit(0)

f = open(filename)
o = open(str(num) + ".txt","w")

lower = ord(f.read(1))
upper = ord(f.read(1))
offset = upper * 256 + lower
#print offset
f.seek(offset)

b = f.read(1)
while (len(b) > 0):
  b = ord(b)
  if (d.has_key(b)):
    o.write(d[b])
  elif ((b == 0xda) or (b == 0xD1) or (b == 0xe2) or (b == 0xe3) or (b == 0xd9)):
    c = f.read(1)
    h = b *256 + ord(c)
    if (d.has_key(h)):
      o.write(d[h])
    else:
      print "0x%04X" % (h)
      o.write("\\x%04X" % (h))
  else:
    print "0x%02X" % (b)
    o.write("\\x%02X" % (b))
  b = f.read(1)
o.close()
